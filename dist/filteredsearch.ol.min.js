!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t){e.exports='<div>\n    <table id="m-filteredsearch-valuestable">\n        <tbody>\n            {{#each values}}\n                <tr>\n                    <td>{{this}}</td>\n                </tr>\n            {{/each}}\n        </tbody>\n    </table>\n    <div id="m-attributetable-tfoot">\n        <button id="prevBtn">&#8810;</button>\n        <span id="pageNumBtn"></span>\n        <button id="nextBtn">&#8811;</button>\n    </div>\n</div>'},function(e,t){e.exports='<div>\n    <table id="m-filteredsearch-fieldstable">\n        <tbody>\n            {{#each fields}}\n                <tr>\n                    <td>{{this}}</td>\n                </tr>\n            {{/each}}\n        </tbody>\n    </table>\n    <div id="m-attributetable-tfoot">\n        <button id="prevBtn">&#8810;</button>\n        <span id="pageNumBtn"></span>\n        <button id="nextBtn">&#8811;</button>\n    </div>\n</div>'},function(e,t){e.exports='<div id="div-contenedor" class="m-control m-container m-filteredsearch">\n\n    <div class="title">Gestor de filtros y búsquedas</div>\n\n    <div id="m-filteredsearch-options-container">\n\n        \x3c!-- <div id="m-filteredsearch-selects-container">\n            <p class="m-filteredsearch-headers">Capa</p>\n            <select id="m-filteredsearch-layers-select">\n                <option disabled="disabled" id="layers0" selected="selected">Seleccione una capa.</option>\n                {{#each layers}}\n                    <option name="{{this.name}}">{{this.name}}</option>\n                {{/each}}\n            </select>\n            <p class="m-filteredsearch-headers">Método</p>\n            <select id="m-filteredsearch-method-select">\n                <option disabled="disabled" selected="selected">Seleccione método.</option>\n                <option>Nueva selección</option>\n                <option>Selección sobre anterior</option>\n                <option>Emilinar sobre anterior</option>\n                <option>Añadir sobre anterior</option>\n            </select>\n        </div>\n\n        <div id="m-filteredsearch-lists-container">\n            <div id="m-filteredsearch-fields">\n                <p class="m-filteredsearch-headers">Campos</p>\n                Insert here fieldstable.html template.\n            </div>\n            <div id="m-filteredsearch-values">\n                <p class="m-filteredsearch-headers">Valores</p>\n                Insert here valuestable.html template.\n            </div>\n        </div>\n\n        <div id="m-filteredsearch-operators-container">\n            <p class="m-filteredsearch-headers">Operadores</p>\n            <button>&#61;</button>\n            <button>&#60;</button>\n            <button>&#62;</button>\n            <button>&#60;&#62;</button>\n            <button>&#62;&#61;</button>\n            <button>&#60;&#61;</button>\n            <button>()</button>\n            <button>And</button>\n            <button>Or</button>\n            <button>Not</button>\n            <button>Like</button>\n            <button>%</button>\n            <button>_</button>\n        </div>\n\n        <div id="m-filteredsearch-query-container">\n            <p class="m-filteredsearch-headers">Expresión de filtrado</p>\n            <textarea cols="90" rows="5" placeholder="La consulta aparecerá aquí."></textarea>\n        </div> --\x3e\n    </div>\n\n    <div id="m-filteredsearch-options-buttons">\n        <button id="volver-btn">Volver</button>\n        <button id="aceptar-btn">Aceptar</button>\n        <button id="limpiar-busqueda-btn">Limpiar búsqueda</button>\n        <button id="limpiar-filtro-btn">Limpiar filtro</button>\n        <button id="vertabla-btn">Ver tabla</button>\n        <button id="exportar-btn">Exportar datos</button>\n        <button id="guardar-btn">Guardar consulta</button>\n        <button id="misconsultas-btn">Mis consultas</button>\n        <button id="eliminar-btn">Eliminar consulta</button>\n    </div>\n\n</div>'},function(e,t){e.exports='<div>\n    <table id=\'queryresults\'></table>\n    <div id="paginationbuttons">\n        <button id="prevBtn">&#8810;</button>\n        <span id="pageNumBtn"></span>\n        <button id="nextBtn">&#8811;</button>\n    </div>\n</div>'},function(e,t){e.exports='<div id="m-filteredsearch-initialview">\n    <div id="m-filteredsearch-selects-container">\n        <p class="m-filteredsearch-headers">Capa</p>\n        <select id="m-filteredsearch-layers-select">\n            <option disabled="disabled" id="layers0" selected="selected">Seleccione una capa.</option>\n            {{#each layers}}\n                <option name="{{this.name}}">{{this.name}}</option>\n            {{/each}}\n        </select>\n        <p class="m-filteredsearch-headers">Método</p>\n        <select id="m-filteredsearch-method-select">\n            <option disabled="disabled" selected="selected">Seleccione método.</option>\n            <option>Nueva selección</option>\n            <option>Selección sobre anterior</option>\n            <option>Eliminar sobre anterior</option>\n            <option>Añadir sobre anterior</option>\n        </select>\n    </div>\n\n    <div id="m-filteredsearch-lists-container">\n        <div id="m-filteredsearch-fields">\n            <p class="m-filteredsearch-headers">Campos</p>\n            \x3c!-- Insert here fieldstable.html template. --\x3e\n        </div>\n        <div id="m-filteredsearch-values">\n            <p class="m-filteredsearch-headers">Valores</p>\n            \x3c!-- Insert here valuestable.html template. --\x3e\n        </div>\n    </div>\n\n    <div id="m-filteredsearch-operators-container">\n        <p class="m-filteredsearch-headers">Operadores</p>\n        \x3c!-- Insert here operator buttons. --\x3e\n    </div>\n\n    <div id="m-filteredsearch-query-container">\n        <p class="m-filteredsearch-headers">Expresión de filtrado</p>\n        <textarea cols="90" rows="5" placeholder="La consulta aparecerá aquí."></textarea>\n    </div>\n</div>'},function(e,t){e.exports="<div>\n    {{#if queries}}\n        <table>\n            {{#each queries}}\n                <tr>\n                    <td>{{this.query}}</td>\n                </tr>\n            {{/each}}\n        </table>\n    {{else}}\n        <p>No hay consultas guardadas.</p>\n    {{/if}}\n</div>"},function(e,t,r){},function(e,t,r){"use strict";r.r(t);r(6);function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e,t,r){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,o(t).apply(this,arguments))}var r,n,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,M.impl.Control),r=t,(n=[{key:"addTo",value:function(e,r){s(o(t.prototype),"addTo",this).call(this,e,r)}}])&&i(r.prototype,n),u&&i(r,u),t}(),c=r(2),d=r.n(c),h=r(1),p=r.n(h),f=r(0),y=r.n(f),b=r(3),v=r.n(b),m=r(4),g=r.n(m),S=r(5),q=r.n(S);function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function L(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function T(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(u)&&M.exception("La implementación usada no puede crear controles FilteredSearchControl");var r=new u;return(e=T(this,E(t).call(this,r,"FilteredSearch"))).sqlQuery="",e.mapeaFilterQuery=null,e.myqueries=[],e.parenthesesClick=0,e.operators=["=","<",">","<=",">=","<>","()","and","or","not","like","%","_"],e.operatorCodes=["&#61;","&lt;","&gt;"],e.fieldsPages=[],e.valuesPages=[],e.fields=[],e.fieldValues=[],e.currentFieldsPage=0,e.currentValuesPage=0,e.resultsPage=0,e.kmlLayers=[],e}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(t,M.Control),r=t,(n=[{key:"createView",value:function(e){var t=this;return this.map=e,new Promise(function(r,n){t.createInitialView(e);var i=M.template.compileSync(d.a);i.querySelector("#m-filteredsearch-options-container").appendChild(t.initialView),t.filterResults=M.template.compileSync(v.a),t.valuesTemplate=M.template.compileSync(y.a,{jsonp:!0,vars:{values:[]}}),t.addEvents(i),t.setInitialButtons(i),t.kmlLayers=t.map.getKML().map(function(e){return{layer:e,loaded:!1}}),r(i)})}},{key:"addEvents",value:function(e){var t=this;this.initialView.querySelector("#m-filteredsearch-layers-select").addEventListener("change",function(e){t.showLayerFields(e.target[e.target.selectedIndex].getAttribute("name"))}),this.initialView.querySelector("#m-filteredsearch-method-select").addEventListener("change",function(e){t.selectionMethod=e.target.value}),e.querySelectorAll("#m-filteredsearch-operators-container>button").forEach(function(e){e.addEventListener("click",function(r){return t.operatorClick(r,e)})}),e.querySelectorAll("#m-filteredsearch-options-buttons>button").forEach(function(e){return e.addEventListener("click",function(e){t.processQuery(e)})}),e.querySelector("#m-filteredsearch-query-container>textarea").addEventListener("input",function(e){t.sqlQuery=e.target.value.replace(/_/g,".").replace(/%/g,".*"),t.setInitialButtons(document.querySelector("#m-filteredsearch-options-buttons"))}),this.map.getKML().forEach(function(e){e.on(M.evt.LOAD,function(){t.kmlLayers.filter(function(t){return t.layer===e})[0].loaded=!0})})}},{key:"createInitialView",value:function(e){var t=this,r={jsonp:!0,vars:{layers:e.getLayers().filter(function(e){return e instanceof M.layer.Vector&&"__draw__"!==e.name})}};this.initialView=M.template.compileSync(g.a,r),this.operators.forEach(function(e){var r=document.createTextNode(e),n=document.createElement("button");n.appendChild(r),t.initialView.querySelector("#m-filteredsearch-operators-container").appendChild(n)})}},{key:"turnStringIntoQuery",value:function(e){var t=[],r=this.findNextOperator(e);if(this.isThisTheLastOperator(e,r))return t[0]=e.substring(0,r.indexes[0]).trim(),t[1]=e.substring(r.indexes[1]+1).trim(),this.translateOrderToQuery(r.operator,t);t=this.saveOperands(e,r.indexes);for(var n=0;n<t.length;n+=1)t[n]=this.turnStringIntoQuery(t[n]);return this.translateOrderToQuery(r.operator,t)}},{key:"findNextOperator",value:function(e){for(var t="",r=[],n=0;n<e.length;n+=1){if("("===e.charAt(n))n=this.findClosingParentheses(e,n)+1;("and"===e.substring(n,n+3)&&!this.operatorInWord(e,[n,n+2])||"or"===e.substring(n,n+2)&&!this.operatorInWord(e,[n,n+1]))&&("and"===e.substring(n,n+3)?(t=e.substring(n,n+3),r[0]=n,r[1]=n+2):(t=e.substring(n,n+2),r[0]=n,r[1]=n+1),n=e.length)}if(""===t)for(var i=0;i<e.length;i+=1){if("("===e.charAt(i))i=this.findClosingParentheses(e,i)+1;("not"===e.substring(i,i+3)&&!this.operatorInWord(e,[i,i+2])||"like"===e.substring(i,i+4)&&!this.operatorInWord(e,[i,i+3]))&&("not"===e.substring(i,i+3)?(t=e.substring(i,i+3),r[0]=i,r[1]=i+2):(t=e.substring(i,i+4),r[0]=i,r[1]=i+3),i=e.length)}if(""===t)for(var a=0;a<e.length;a+=1){if("("===e.charAt(a))a=this.findClosingParentheses(e,a)+1;"<="===e.substring(a,a+2)||">="===e.substring(a,a+2)||"<>"===e.substring(a,a+2)?(t=e.substring(a,a+2),r[0]=a,r[1]=a+1,a=e.length):"="!==e.charAt(a)&&"<"!==e.charAt(a)&&">"!==e.charAt(a)||(t=e.charAt(a),r[0]=a,r[1]=a,a=e.length)}return{operator:t,indexes:r}}},{key:"isThisTheLastOperator",value:function(e,t){var r=this,n=!0,i=["=","<=",">=","<>","(","and","or","not","like"],a="".concat(e.substring(0,t.indexes[0])).concat(e.substring(t.indexes[1]+1));return i.some(function(e){var t=a.indexOf(e)>=0,n=[a.indexOf(e),a.indexOf(e)+i[i.indexOf(e)].length-1],s=!r.operatorInWord(a,n);return t&&s})&&(n=!1),n}},{key:"saveOperands",value:function(e,t){var r=[],n=t[0],i=t[1];return 0!==n&&r.push(e.substring(0,n).trim()),r.push(e.substring(i+1).trim()),r=r.map(function(e){var t=e;return"("===e[0]&&(t=t.substring(1)),")"===e[e.length-1]&&(t=t.substring(0,e.length-1)),t})}},{key:"translateOrderToQuery",value:function(e,t){var r,n,i,a,s,o,l,u="";switch(e){case"=":u=(r=M.filter).EQUAL.apply(r,w(t));break;case"<>":var c=t[0],d=t[1];u=new M.filter.Function(function(e){return e.getAttribute(c)!==d});break;case"<":u=(n=M.filter).LT.apply(n,w(t));break;case">":u=(i=M.filter).GT.apply(i,w(t));break;case"<=":u=(a=M.filter).LTE.apply(a,w(t));break;case">=":u=(s=M.filter).GTE.apply(s,w(t));break;case"and":u=M.filter.AND(w(t));break;case"or":u=M.filter.OR(w(t));break;case"like":u=(o=M.filter).LIKE.apply(o,w(t));break;case"not":u=(l=M.filter).NOT.apply(l,w(t))}return u}},{key:"findClosingParentheses",value:function(e,t){for(var r,n=0,i=t+1;i<e.length;i+=1)0===n&&")"===e.charAt(i)?(r=i,i=e.length):"("===e.charAt(i)?n+=1:")"===e.charAt(i)&&0!==n&&(n-=1);return r}},{key:"operatorInWord",value:function(e,t){var r=!1,n=t[0],i=t[1],a=e[n-1],s=e[i+1];return(void 0!==a&&a.match(/[a-z]/i)||void 0!==s&&s.match(/[a-z]/i))&&(r=!0),r}},{key:"isMapeaFilterParentheses",value:function(e,t){var r=t,n=!1;return(r-11!=-1&&"M.filter."===e.substring(r-11,r-2)&&["OR","LT","GT"].includes(e.substring(r-2,r))||r-12!=-1&&"M.filter."===e.substring(r-12,r-3)&&["AND","NOT","LTE","GTE"].includes(e.substring(r-3,r))||r-13!=-1&&"M.filter."===e.substring(r-13,r-4)&&"LIKE"===e.substring(r-4,r)||r-14!=-1&&"M.filter."===e.substring(r-14,r-5)&&"EQUAL"===e.substring(r-5,r))&&(n=!0),n}},{key:"getMethodFilter",value:function(e){var t;switch(this.selectionMethod){case"Nueva selección":t=e;break;case"Selección sobre anterior":void 0!==this.oldFilter?t=M.filter.AND([this.oldFilter,e]):M.dialog.error("No existe una consulta previa.");break;case"Eliminar sobre anterior":void 0!==this.oldFilter?t=M.filter.AND([this.oldFilter,M.filter.NOT(e)]):M.dialog.error("No existe una consulta previa.");break;case"Añadir sobre anterior":void 0!==this.oldFilter?t=M.filter.OR([this.oldFilter,e]):M.dialog.error("No existe una consulta previa.");break;default:M.dialog.error("Debe seleccionar un método.")}return t}},{key:"processQuery",value:function(e){var t=document.querySelector("#m-filteredsearch-options-container"),r=document.querySelector("#m-filteredsearch-options-buttons");switch(e.target.getAttribute("id")){case"aceptar-btn":void 0===this.layer_?M.dialog.error("Debe seleccionar una capa."):("Nueva selección"===this.selectionMethod&&(this.oldFilter=void 0,this.oldLayer=void 0),this.setNewFilter(),this.isValidQuery&&void 0!==this.selectionMethod&&this.setOkButtons());break;case"limpiar-busqueda-btn":this.cleanSearch();break;case"limpiar-filtro-btn":this.layer_.removeFilter(),this.setInitialButtons(r);break;case"vertabla-btn":this.saveResultsOnTable(),t.innerHTML="",t.appendChild(this.filterResults),this.setTableViewButtons(r);break;case"exportar-btn":this.exportResults();break;case"guardar-btn":this.isValidQuery?this.myqueries.push({query:this.sqlQuery,layer:this.layer_}):M.dialog.error("Consulta inválida.");break;case"misconsultas-btn":this.myQueriesClick(t),this.showMyQueriesViewButtons(r);break;case"volver-btn":t.innerHTML="",t.appendChild(this.initialView),this.setOkButtons(),document.querySelector("#guardar-btn").style.display="none";break;case"eliminar-btn":break;default:console.log("Este botón no tiene funcionalidad.")}}},{key:"myQueriesClick",value:function(e){var t=e;t.innerHTML="",this.compileMyQueriesTemplate(),this.addSavedQueryClick(),t.appendChild(this.savedQueriesView)}},{key:"addSavedQueryClick",value:function(){var e=this;this.savedQueriesView.querySelectorAll("td").forEach(function(t,r){t.addEventListener("click",function(n){e.savedQueryClicked(n,t,r)})})}},{key:"savedQueryClicked",value:function(e,t,r){var n=this;this.deleteAppliedFilters(),this.clickedQuery=this.myqueries[r],this.mapeaFilterQuery=this.turnStringIntoQuery(this.clickedQuery.query),this.layer_=this.clickedQuery.layer,this.layer_.setFilter(this.mapeaFilterQuery),Array.prototype.forEach.call(e.target.parentNode.parentNode.parentNode.children[0].children,function(e){Array.prototype.forEach.call(e.children,function(e){e.classList.remove("focus")})}),e.target.classList.add("focus");var i=document.querySelector("#m-filteredsearch-options-buttons").querySelector("#eliminar-btn");i.style.display="inline",i.onclick=function(){n.deleteSavedQuery(t,r),n.compileMyQueriesTemplate(),n.addSavedQueryClick(),document.querySelector("#m-filteredsearch-options-container").appendChild(n.savedQueriesView)}}},{key:"deleteSavedQuery",value:function(e,t){this.myqueries.splice(t,1),e.parentNode.remove(),document.querySelector("#m-filteredsearch-options-buttons").querySelector("#eliminar-btn").style.display="none",this.sqlQuery="",this.layer_.removeFilter(),0===this.myqueries.length&&(document.querySelector("#m-filteredsearch-options-container").innerHTML="No hay consultas guardadas.")}},{key:"compileMyQueriesTemplate",value:function(){if(void 0!==this.savedQueriesView)for(var e=this.savedQueriesView.lastElementChild;e;)e.remove(),e=this.savedQueriesView.lastElementChild;this.mySqlQueries=this.myqueries.map(function(e){var t=e;return t.query=e.query.replace(/\.\*/g,"%").replace(/\./g,"_"),t}),this.savedQueriesView=M.template.compileSync(q.a,{vars:{queries:this.mySqlQueries}})}},{key:"deleteAppliedFilters",value:function(){this.map.getWFS().concat(this.map.getKML().concat(this.map.getLayers().filter(function(e){return"GeoJSON"===e.type}))).forEach(function(e){null!==e.getFilter&&e.removeFilter()})}},{key:"setNewFilter",value:function(){if(""===this.sqlQuery)M.dialog.error("Debe introducir una consulta."),this.mapeaFilterQuery=this.oldFilter,this.layer_=this.oldLayer;else if(void 0!==this.oldLayer&&this.oldLayer!==this.layer_)M.dialog.error("No se puede aplicar una consulta combinada sobre dos capas diferentes."),this.mapeaFilterQuery=this.oldFilter,this.layer_=this.oldLayer;else{var e;try{if(e=this.turnStringIntoQuery(this.sqlQuery),e=this.getMethodFilter(e),this.layer_.setFilter(e),null===this.layer_.getFilter())throw this.isValidQuery=!1,new Error("Error: Filtro inválido");this.mapeaFilterQuery=e,this.oldFilter=this.mapeaFilterQuery,this.oldLayer=this.layer_,this.isValidQuery=!0}catch(e){this.isValidQuery=!1,M.dialog.error("No se ha podido aplicar el filtro.")}}}},{key:"exportResults",value:function(){var e=this.layer_.getFeatures();if(e.length>0){var t=this.dataToCsv(e);this.downloadCsv(t)}else M.dialog.error("No hay datos para exportar.")}},{key:"dataToCsv",value:function(e){var t="",r=Object.keys(e[0].getAttributes());return r.forEach(function(e){t+="".concat(e,",")}),t="".concat(t.substring(0,t.length-1),"\n"),e.forEach(function(e){var n=e.getAttributes();r.forEach(function(e){t+=n[e],t+=","}),t="".concat(t.substring(0,t.length-1),"\n")}),t=t.substring(0,t.length-1)}},{key:"downloadCsv",value:function(e){var t="data:text/csv;charset=utf-8,".concat(encodeURI(e)),r=document.createElement("a");r.href=t,r.download="queryresults.csv",r.click()}},{key:"setInitialButtons",value:function(e){var t=e;t.querySelector("#volver-btn").style.display="none",t.querySelector("#aceptar-btn").style.display="inline",t.querySelector("#limpiar-busqueda-btn").style.display="inline",t.querySelector("#limpiar-filtro-btn").style.display="inline",t.querySelector("#vertabla-btn").style.display="none",t.querySelector("#exportar-btn").style.display="none",t.querySelector("#guardar-btn").style.display="none",t.querySelector("#misconsultas-btn").style.display="inline",t.querySelector("#eliminar-btn").style.display="none"}},{key:"setOkButtons",value:function(){document.querySelector("#volver-btn").style.display="none",document.querySelector("#aceptar-btn").style.display="inline",document.querySelector("#limpiar-busqueda-btn").style.display="inline",document.querySelector("#limpiar-filtro-btn").style.display="inline",document.querySelector("#vertabla-btn").style.display="inline",document.querySelector("#exportar-btn").style.display="inline",document.querySelector("#guardar-btn").style.display="inline",document.querySelector("#misconsultas-btn").style.display="inline"}},{key:"setTableViewButtons",value:function(e){var t=e;t.querySelector("#volver-btn").style.display="inline",t.querySelector("#aceptar-btn").style.display="none",t.querySelector("#limpiar-busqueda-btn").style.display="none",t.querySelector("#limpiar-filtro-btn").style.display="none",t.querySelector("#vertabla-btn").style.display="none",t.querySelector("#exportar-btn").style.display="none",t.querySelector("#guardar-btn").style.display="none",t.querySelector("#misconsultas-btn").style.display="none"}},{key:"showMyQueriesViewButtons",value:function(e){var t=e;t.querySelector("#volver-btn").style.display="inline",t.querySelector("#aceptar-btn").style.display="none",t.querySelector("#limpiar-busqueda-btn").style.display="none",t.querySelector("#limpiar-filtro-btn").style.display="none",t.querySelector("#vertabla-btn").style.display="none",t.querySelector("#exportar-btn").style.display="none",t.querySelector("#guardar-btn").style.display="none",t.querySelector("#misconsultas-btn").style.display="none"}},{key:"cleanSearch",value:function(){document.querySelector(".filtered-search-panel").querySelector("textarea").value="",document.querySelector("#m-filteredsearch-method-select").value="Seleccione método.",this.selectionMethod="",this.sqlQuery="",document.querySelector("#m-filteredsearch-layers-select").querySelector("#layers0").selected=!0,document.querySelector("#m-filteredsearch-fields").innerHTML='<p class="m-filteredsearch-headers">Campos</p>',document.querySelector("#m-filteredsearch-values").innerHTML='<p class="m-filteredsearch-headers">Valores</p>'}},{key:"showTableViewPage",value:function(e){var t=this;this.filterResults.querySelector("#queryresults").innerHTML="";var r=this.layer_.getFeatures()[0].getAttributes(),n=document.createElement("tr");Object.keys(r).forEach(function(e){var t=document.createElement("th"),r=document.createTextNode(e);t.appendChild(r),n.appendChild(t)}),this.filterResults.querySelector("#queryresults").appendChild(n),this.filterResults.querySelector("#paginationbuttons>#pageNumBtn").innerHTML="".concat(this.resultsPage+1," de ").concat(e.length),e[this.resultsPage].forEach(function(e){n=document.createElement("tr");var r=e.getAttributes();Object.keys(r).forEach(function(e){var t=document.createElement("td"),i=document.createTextNode(r[e].toString());t.appendChild(i),n.appendChild(t)}),t.filterResults.querySelector("#queryresults").appendChild(n)})}},{key:"saveResultsOnTable",value:function(){var e=this;if(this.layer_.getFeatures().length>0){var t=this.divideList(this.layer_.getFeatures());this.showTableViewPage(t),this.filterResults.querySelectorAll("#paginationbuttons>button").forEach(function(r){r.addEventListener("click",function(r){"prevBtn"===r.target.id?e.resultsPage=e.resultsPage>0?e.resultsPage-=1:e.resultsPage:e.resultsPage=e.resultsPage<t.length-1?e.resultsPage+=1:e.resultsPage,e.showTableViewPage(t)})})}else this.filterResults.innerHTML="No hay entidades con las caracerísticas indicadas."}},{key:"operatorClick",value:function(e,t){var r=document.querySelector(".filtered-search-panel").querySelector("textarea");switch(t.innerHTML){case"()":0===this.parenthesesClick?(r.value+="(",this.sqlQuery+="(",this.parenthesesClick=1):(r.value+=")",this.sqlQuery+=")",this.parenthesesClick=0);break;case"&#61;":r.value+=" = ",this.sqlQuery+=" = ";break;case"&lt;":r.value+=" < ",this.sqlQuery+=" < ";break;case"&gt;":r.value+=" > ",this.sqlQuery+=" > ";break;case"&lt;&gt;":r.value+=" <> ",this.sqlQuery+=" <> ";break;case"&gt;=":r.value+=" >= ",this.sqlQuery+=" >= ";break;case"&lt;=":r.value+=" <= ",this.sqlQuery+=" <= ";break;case"_":r.value+="_",this.sqlQuery+=".";break;case"%":r.value+="%",this.sqlQuery+=".*";break;default:r.value+=" ".concat(t.innerHTML.toLowerCase()," "),this.sqlQuery+=" ".concat(t.innerHTML.toLowerCase()," ")}}},{key:"showLayerFields",value:function(e){var t=this;if(M.utils.isNullOrEmpty(e)||(this.layer_=this.hasLayer_(e)[0]),this.isLayerLoaded(this.layer_)){this.fieldValues=[];var r=this.layer_.getFeatures();if(this.oldFilter=this.mapeaFilterQuery,this.oldLayer=this.layer_,document.querySelector(".filtered-search-panel").querySelector("textarea").value="",this.sqlQuery="",this.mapeaFilterQuery=null,!M.utils.isNullOrEmpty(r)){this.fields=Object.keys(r[0].getAttributes()),r.forEach(function(e){var r=Object.values(e.getAttributes());M.utils.isNullOrEmpty(r)||t.fieldValues.push(r)}),this.fieldsPages=this.divideList(this.fields);var n={jsonp:!0,vars:{fields:this.fieldsPages[0]}};this.fieldsTemplate=M.template.compileSync(p.a,n),this.fieldsTemplate.querySelector("#pageNumBtn").innerHTML="1 de ".concat(this.fieldsPages.length),document.querySelector("#m-filteredsearch-fields").innerHTML='<p class="m-filteredsearch-headers">Campos</p>',document.querySelector("#m-filteredsearch-fields").appendChild(this.fieldsTemplate),this.showFields(),this.addpageBtnEvt()}}else M.dialog.error("La capa no se ha cargado todavía.")}},{key:"isLayerLoaded",value:function(e){var t=!1;return"KML"!==e.type&&e.getImpl().isLoaded()?t=!0:this.kmlLayers.filter(function(t){return t.layer===e})[0].loaded&&(t=!0),t}},{key:"showFields",value:function(){var e=this;document.querySelector("#m-filteredsearch-fields").querySelectorAll("td").forEach(function(t){var r=[],n=e.fields.indexOf(t.innerHTML);e.fieldValues.forEach(function(e){r.push(e[n])}),t.addEventListener("click",function(t){document.querySelector(".filtered-search-panel").querySelector("textarea").value+=t.target.innerHTML,e.sqlQuery+=t.target.innerHTML,e.selectField(r),Array.prototype.forEach.call(t.target.parentNode.parentNode.parentNode.children[0].children,function(e){Array.prototype.forEach.call(e.children,function(e){e.classList.remove("focus")})}),t.target.classList.add("focus")})})}},{key:"addpageBtnEvt",value:function(){var e=this;this.fieldsTemplate.querySelectorAll("#m-attributetable-tfoot>button").forEach(function(t){t.addEventListener("click",function(t){return e.changePage(t,"fields",e.fieldsPages.length)})}),this.valuesTemplate.querySelectorAll("#m-attributetable-tfoot>button").forEach(function(t){t.addEventListener("click",function(t){return e.changePage(t,"values",e.valuesPages.length)})})}},{key:"divideList",value:function(e){for(var t=[],r=0;r<e.length;){for(var n=[],i=r;i<r+5;i+=1)n.push(e[i]),i+1===e.length&&(i=r+5);t.push(n),r+=5}return t}},{key:"changePage",value:function(e,t,r){var n="fields"===t?this.currentFieldsPage:this.currentValuesPage;n="prevBtn"===e.target.id?n>0?n-=1:n:n<r-1?n+=1:n,"fields"===t?this.currentFieldsPage=n:this.currentValuesPage=n,this.showPageResults(t),this.addpageBtnEvt()}},{key:"showPageResults",value:function(e){var t=this;if("fields"===e){var r={jsonp:!0,vars:{fields:this.fieldsPages[this.currentFieldsPage]}};this.fieldsTemplate=M.template.compileSync(p.a,r),this.fieldsTemplate.querySelector("#pageNumBtn").innerHTML="".concat(this.currentFieldsPage+1," de ").concat(this.fieldsPages.length),this.showFields()}else{var n={jsonp:!0,vars:{values:this.valuesPages[this.currentValuesPage]}};this.valuesTemplate=M.template.compileSync(y.a,n),this.valuesTemplate.querySelector("#pageNumBtn").innerHTML="".concat(this.currentValuesPage+1," de ").concat(this.valuesPages.length),this.fieldsTemplate.querySelector("#pageNumBtn").innerHTML="".concat(this.currentFieldsPage+1," de ").concat(this.fieldsPages.length),document.querySelector("#m-filteredsearch-values").innerHTML='<p class="m-filteredsearch-headers">Valores</p>',document.querySelector("#m-filteredsearch-values").appendChild(this.valuesTemplate),document.querySelector("#m-filteredsearch-values").querySelectorAll("td").forEach(function(e){e.addEventListener("click",function(e){document.querySelector(".filtered-search-panel").querySelector("textarea").value+=e.target.innerHTML,t.sqlQuery+=e.target.innerHTML,Array.prototype.forEach.call(e.target.parentNode.parentNode.parentNode.children[0].children,function(e){Array.prototype.forEach.call(e.children,function(e){e.classList.remove("focus")})}),e.target.classList.add("focus")})})}}},{key:"selectField",value:function(e){var t=this,r=e.filter(function(e,t,r){return r.indexOf(e)===t});this.valuesPages=this.divideList(r);var n={jsonp:!0,vars:{values:this.valuesPages[0]}};this.currentFieldsPage=0,this.currentValuesPage=0,this.valuesTemplate=M.template.compileSync(y.a,n),this.valuesTemplate.querySelector("#pageNumBtn").innerHTML="".concat(this.currentValuesPage+1," de ").concat(this.valuesPages.length),this.valuesTemplate.querySelectorAll("#m-filteredsearch-valuestable>tbody>tr>td").forEach(function(e){e.addEventListener("click",function(e){return t.selectValue(e)})}),document.querySelector("#m-filteredsearch-values").innerHTML="<p class='m-filteredsearch-headers'>Valores</p>",document.querySelector("#m-filteredsearch-values").appendChild(this.valuesTemplate),this.addpageBtnEvt()}},{key:"selectValue",value:function(e){document.querySelector(".filtered-search-panel").querySelector("textarea").value+=e.currentTarget.innerHTML,this.sqlQuery+=e.currentTarget.innerHTML,Array.prototype.forEach.call(e.currentTarget.parentNode.parentNode.children,function(e){e.children[0].classList.remove("focus")}),e.currentTarget.classList.add("focus")}},{key:"hasLayer_",value:function(e){var t=[];return!M.utils.isNullOrEmpty(e)&&(M.utils.isArray(e)||M.utils.isString(e)||e instanceof M.Layer)?(M.utils.isString(e)&&this.map.getLayers().forEach(function(r){r.name===e&&t.push(r)}),e instanceof M.Layer&&this.map.getLayers().forEach(function(r){r.equals(e)&&t.push(r)}),M.utils.isArray(e)&&this.map.getLayers().forEach(function(r){e.indexOf(r.name)>=0&&t.push(r)}),t):(M.dialog.error("El parametro para el método hasLayer no es correcto.","Error"),t)}},{key:"equals",value:function(e){return e instanceof t}}])&&L(r.prototype,n),i&&L(r,i),t}();function Q(e){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _(e,t){return!t||"object"!==Q(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var A=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=_(this,F(t).call(this))).map_=null,r.controls_=[],r.position=e.position||"TR",r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(t,M.Plugin),r=t,(n=[{key:"addTo",value:function(e){this.controls_.push(new P),this.map_=e,this.panel_=new M.ui.Panel("panelFilteredSearch",{className:"filtered-search-panel",collapsible:!0,position:M.ui.position[this.position_],collapsedButtonClass:"g-cartografia-flecha-izquierda"}),this.panel_.addControls(this.controls_),e.addPanels(this.panel_)}}])&&x(r.prototype,n),i&&x(r,i),t}();window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.FilteredSearch=A,window.M.control.FilteredSearchControl=P,window.M.impl.control.FilteredSearchControl=u}]);
//# sourceMappingURL=filteredsearch.ol.min.js.map