{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/templates/valuestable.html","webpack:///./src/templates/fieldstable.html","webpack:///./src/templates/filteredsearch.html","webpack:///./src/templates/seeresults.html","webpack:///./src/templates/initialview.html","webpack:///./src/templates/savedqueries.html","webpack:///./src/impl/ol/js/filteredsearchcontrol.js","webpack:///./src/facade/js/filteredsearchcontrol.js","webpack:///./src/facade/js/filteredsearch.js","webpack:///./src/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","FilteredSearchControl","M","impl","Control","map","html","_get","_getPrototypeOf","this","_this","filteredsearchcontrol_classCallCheck","utils","isUndefined","FilteredSearchImplControl","exception","filteredsearchcontrol_possibleConstructorReturn","filteredsearchcontrol_getPrototypeOf","sqlQuery","mapeaFilterQuery","myqueries","parenthesesClick","operators","operatorCodes","fieldsPages","valuesPages","fields","fieldValues","currentFieldsPage","currentValuesPage","resultsPage","kmlLayers","_this2","Promise","success","fail","createInitialView","template","compileSync","querySelector","appendChild","initialView","filterResults","seeResults","valuesTemplate","jsonp","vars","values","addEvents","setInitialButtons","getKML","layer","loaded","_this3","addEventListener","evt","showLayerFields","target","selectedIndex","getAttribute","selectionMethod","querySelectorAll","forEach","element","e","operatorClick","btn","processQuery","replace","document","kmlLayer","on","LOAD","filter","_this4","options","layers","getLayers","Vector","operator","btnTextNode","createTextNode","buttonNode","createElement","stringQ","pieces","nextOperator","findNextOperator","isThisTheLastOperator","substring","indexes","trim","translateOrderToQuery","saveOperands","length","turnStringIntoQuery","query","charAt","findClosingParentheses","operatorInWord","_this5","isLastOp","ops","cutQuery","concat","some","v","operatorContainedInQuery","indexOf","possibleOperatorIndexes","operatorNotInWord","startEndIndexes","operands","startSplitIndex","endSplitIndex","push","operand","newOperand","_M$filter","_M$filter2","_M$filter3","_M$filter4","_M$filter5","_M$filter6","_M$filter7","mFilter","EQUAL","apply","_toConsumableArray","attr","val","Function","feature","LT","GT","LTE","GTE","AND","OR","LIKE","NOT","openingIndex","closingParenthesesIndex","parenthesesCounter","operatorIndexes","inWord","previousChar","nextChar","undefined","match","index","position","isMFilterPar","includes","mapeaFilter","combinedFilter","oldFilter","dialog","error","optsContainer","btnContainer","layer_","oldLayer","setNewFilter","isValidQuery","setOkButtons","cleanSearch","removeFilter","saveResultsOnTable","innerHTML","setTableViewButtons","exportResults","myQueriesClick","showMyQueriesViewButtons","style","display","console","log","container","compileMyQueriesTemplate","addSavedQueryClick","savedQueriesView","_this6","td","idx","savedQueryClicked","_this7","deleteAppliedFilters","clickedQuery","setFilter","Array","parentNode","children","row","rowCell","classList","remove","add","deleteBtn","onclick","deleteSavedQuery","splice","child","lastElementChild","mySqlQueries","q","newQuery","savedQueries","queries","getWFS","type","getFilter","tryFilter","getMethodFilter","Error","err","features","getFeatures","csvString","dataToCsv","downloadCsv","csv","featureKeys","keys","getAttributes","featureAttrs","csvdata","fileUrl","encodeURI","hiddenLink","href","download","click","panelContainer","selected","pages","_this8","attributes","newLine","attributeKey","newTitleCell","cellText","filteredFeature","filteredAttributes","newCell","txt","toString","_this9","divideList","showTableViewPage","id","txtarea","toLowerCase","layerName","_this10","isNullOrEmpty","hasLayer_","isLayerLoaded","properties","fieldsTemplate","showFields","addpageBtnEvt","isLoaded","getImpl","_this11","cell","fieldIndex","selectField","_this12","changePage","items","firstItem","newPage","fieldsOrValues","numberOfPages","currentPage","showPageResults","_this13","_this14","self","tableCell","selectValue","currentTarget","layerSearch","layersFind","isArray","isString","Layer","lay","equals","control","FilteredSearch","filteredsearch_classCallCheck","filteredsearch_possibleConstructorReturn","filteredsearch_getPrototypeOf","map_","controls_","Plugin","panel_","ui","Panel","className","collapsible","position_","collapsedButtonClass","addControls","addPanels","window","plugin","M$plugin$FilteredSearch","M$control$FilteredSearchControl","M$impl$control$FilteredSearchControl"],"mappings":"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","file":"filteredsearch.ol.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 7);\n","module.exports = \"<div>\\n    <table id=\\\"m-filteredsearch-valuestable\\\">\\n        <tbody>\\n            {{#each values}}\\n                <tr>\\n                    <td>{{this}}</td>\\n                </tr>\\n            {{/each}}\\n        </tbody>\\n    </table>\\n    <div id=\\\"m-attributetable-tfoot\\\">\\n        <button id=\\\"prevBtn\\\">&#8810;</button>\\n        <span id=\\\"pageNumBtn\\\"></span>\\n        <button id=\\\"nextBtn\\\">&#8811;</button>\\n    </div>\\n</div>\";","module.exports = \"<div>\\n    <table id=\\\"m-filteredsearch-fieldstable\\\">\\n        <tbody>\\n            {{#each fields}}\\n                <tr>\\n                    <td>{{this}}</td>\\n                </tr>\\n            {{/each}}\\n        </tbody>\\n    </table>\\n    <div id=\\\"m-attributetable-tfoot\\\">\\n        <button id=\\\"prevBtn\\\">&#8810;</button>\\n        <span id=\\\"pageNumBtn\\\"></span>\\n        <button id=\\\"nextBtn\\\">&#8811;</button>\\n    </div>\\n</div>\";","module.exports = \"<div id=\\\"div-contenedor\\\" class=\\\"m-control m-container m-filteredsearch\\\">\\n\\n    <div class=\\\"title\\\">Gestor de filtros y búsquedas</div>\\n\\n    <div id=\\\"m-filteredsearch-options-container\\\">\\n\\n        <!-- <div id=\\\"m-filteredsearch-selects-container\\\">\\n            <p class=\\\"m-filteredsearch-headers\\\">Capa</p>\\n            <select id=\\\"m-filteredsearch-layers-select\\\">\\n                <option disabled=\\\"disabled\\\" id=\\\"layers0\\\" selected=\\\"selected\\\">Seleccione una capa.</option>\\n                {{#each layers}}\\n                    <option name=\\\"{{this.name}}\\\">{{this.name}}</option>\\n                {{/each}}\\n            </select>\\n            <p class=\\\"m-filteredsearch-headers\\\">Método</p>\\n            <select id=\\\"m-filteredsearch-method-select\\\">\\n                <option disabled=\\\"disabled\\\" selected=\\\"selected\\\">Seleccione método.</option>\\n                <option>Nueva selección</option>\\n                <option>Selección sobre anterior</option>\\n                <option>Emilinar sobre anterior</option>\\n                <option>Añadir sobre anterior</option>\\n            </select>\\n        </div>\\n\\n        <div id=\\\"m-filteredsearch-lists-container\\\">\\n            <div id=\\\"m-filteredsearch-fields\\\">\\n                <p class=\\\"m-filteredsearch-headers\\\">Campos</p>\\n                Insert here fieldstable.html template.\\n            </div>\\n            <div id=\\\"m-filteredsearch-values\\\">\\n                <p class=\\\"m-filteredsearch-headers\\\">Valores</p>\\n                Insert here valuestable.html template.\\n            </div>\\n        </div>\\n\\n        <div id=\\\"m-filteredsearch-operators-container\\\">\\n            <p class=\\\"m-filteredsearch-headers\\\">Operadores</p>\\n            <button>&#61;</button>\\n            <button>&#60;</button>\\n            <button>&#62;</button>\\n            <button>&#60;&#62;</button>\\n            <button>&#62;&#61;</button>\\n            <button>&#60;&#61;</button>\\n            <button>()</button>\\n            <button>And</button>\\n            <button>Or</button>\\n            <button>Not</button>\\n            <button>Like</button>\\n            <button>%</button>\\n            <button>_</button>\\n        </div>\\n\\n        <div id=\\\"m-filteredsearch-query-container\\\">\\n            <p class=\\\"m-filteredsearch-headers\\\">Expresión de filtrado</p>\\n            <textarea cols=\\\"90\\\" rows=\\\"5\\\" placeholder=\\\"La consulta aparecerá aquí.\\\"></textarea>\\n        </div> -->\\n    </div>\\n\\n    <div id=\\\"m-filteredsearch-options-buttons\\\">\\n        <button id=\\\"volver-btn\\\">Volver</button>\\n        <button id=\\\"aceptar-btn\\\">Aceptar</button>\\n        <button id=\\\"limpiar-busqueda-btn\\\">Limpiar búsqueda</button>\\n        <button id=\\\"limpiar-filtro-btn\\\">Limpiar filtro</button>\\n        <button id=\\\"vertabla-btn\\\">Ver tabla</button>\\n        <button id=\\\"exportar-btn\\\">Exportar datos</button>\\n        <button id=\\\"guardar-btn\\\">Guardar consulta</button>\\n        <button id=\\\"misconsultas-btn\\\">Mis consultas</button>\\n        <button id=\\\"eliminar-btn\\\">Eliminar consulta</button>\\n    </div>\\n\\n</div>\";","module.exports = \"<div>\\n    <table id='queryresults'></table>\\n    <div id=\\\"paginationbuttons\\\">\\n        <button id=\\\"prevBtn\\\">&#8810;</button>\\n        <span id=\\\"pageNumBtn\\\"></span>\\n        <button id=\\\"nextBtn\\\">&#8811;</button>\\n    </div>\\n</div>\";","module.exports = \"<div id=\\\"m-filteredsearch-initialview\\\">\\n    <div id=\\\"m-filteredsearch-selects-container\\\">\\n        <p class=\\\"m-filteredsearch-headers\\\">Capa</p>\\n        <select id=\\\"m-filteredsearch-layers-select\\\">\\n            <option disabled=\\\"disabled\\\" id=\\\"layers0\\\" selected=\\\"selected\\\">Seleccione una capa.</option>\\n            {{#each layers}}\\n                <option name=\\\"{{this.name}}\\\">{{this.name}}</option>\\n            {{/each}}\\n        </select>\\n        <p class=\\\"m-filteredsearch-headers\\\">Método</p>\\n        <select id=\\\"m-filteredsearch-method-select\\\">\\n            <option disabled=\\\"disabled\\\" selected=\\\"selected\\\">Seleccione método.</option>\\n            <option>Nueva selección</option>\\n            <option>Selección sobre anterior</option>\\n            <option>Eliminar sobre anterior</option>\\n            <option>Añadir sobre anterior</option>\\n        </select>\\n    </div>\\n\\n    <div id=\\\"m-filteredsearch-lists-container\\\">\\n        <div id=\\\"m-filteredsearch-fields\\\">\\n            <p class=\\\"m-filteredsearch-headers\\\">Campos</p>\\n            <!-- Insert here fieldstable.html template. -->\\n        </div>\\n        <div id=\\\"m-filteredsearch-values\\\">\\n            <p class=\\\"m-filteredsearch-headers\\\">Valores</p>\\n            <!-- Insert here valuestable.html template. -->\\n        </div>\\n    </div>\\n\\n    <div id=\\\"m-filteredsearch-operators-container\\\">\\n        <p class=\\\"m-filteredsearch-headers\\\">Operadores</p>\\n        <!-- Insert here operator buttons. -->\\n    </div>\\n\\n    <div id=\\\"m-filteredsearch-query-container\\\">\\n        <p class=\\\"m-filteredsearch-headers\\\">Expresión de filtrado</p>\\n        <textarea cols=\\\"90\\\" rows=\\\"5\\\" placeholder=\\\"La consulta aparecerá aquí.\\\"></textarea>\\n    </div>\\n</div>\";","module.exports = \"<div>\\n    {{#if queries}}\\n        <table>\\n            {{#each queries}}\\n                <tr>\\n                    <td>{{this.query}}</td>\\n                </tr>\\n            {{/each}}\\n        </table>\\n    {{else}}\\n        <p>No hay consultas guardadas.</p>\\n    {{/if}}\\n</div>\";","/**\n * @module M/impl/control/FilteredSearchControl\n */\nexport default class FilteredSearchControl extends M.impl.Control {\n  /**\n   * This function adds the control to the specified map\n   *\n   * @public\n   * @function\n   * @param {M.Map} map to add the plugin\n   * @param {HTMLElement} html of the plugin\n   * @api stable\n   */\n  addTo(map, html) {\n    // obtengo la interacción por defecto del dblclick para manejarla\n    // const olMap = map.getMapImpl();\n    super.addTo(map, html);\n  }\n}\n","/**\n * @module M/control/FilteredSearchControl\n */\n\nimport FilteredSearchImplControl from 'impl/filteredsearchcontrol';\nimport template from 'templates/filteredsearch';\nimport fieldsTemplate from 'templates/fieldstable';\nimport valuesTemplate from 'templates/valuestable';\nimport seeResults from 'templates/seeresults';\nimport initialView from 'templates/initialview';\nimport savedQueries from 'templates/savedqueries';\n\nexport default class FilteredSearchControl extends M.Control {\n  /**\n   * @classdesc\n   * Main constructor of the class. Creates a PluginControl\n   * control\n   *\n   * @constructor\n   * @extends {M.Control}\n   * @api stable\n   */\n  constructor() {\n    if (M.utils.isUndefined(FilteredSearchImplControl)) {\n      M.exception('La implementación usada no puede crear controles FilteredSearchControl');\n    }\n    const impl = new FilteredSearchImplControl();\n    super(impl, 'FilteredSearch');\n\n    /**\n     * Filtering query (written in sql style)\n     * @public\n     */\n    this.sqlQuery = '';\n\n    /**\n     * Mapea filter with the user's query.\n     * @public\n     */\n    this.mapeaFilterQuery = null;\n\n    /**\n     * Saved queries\n     * @public\n     */\n    this.myqueries = [];\n\n    /**\n     * Parentheses click counter\n     * @public\n     * If 0, a '(' is written. If 1, a ')'.\n     */\n    this.parenthesesClick = 0;\n\n    /**\n     * Operators for creating queries\n     * @public\n     */\n    this.operators = ['=', '<', '>', '<=', '>=', '<>', '()', 'and', 'or', 'not', 'like', '%', '_'];\n\n    /**\n     * Operators html codes.\n     * @public\n     */\n    this.operatorCodes = ['&#61;', '&lt;', '&gt;'];\n\n    /**\n     * Layer fields items divided by page.\n     * format: [[item_1, item_2, item_3], [i4, i5, i6], ... ]\n     * @public\n     */\n    this.fieldsPages = [];\n\n    /**\n     * Layer field values items divided by page.\n     * format: [[item_1, item_2, item_3], [i4, i5, i6], ... ]\n     * @public\n     */\n    this.valuesPages = [];\n\n    /**\n     * Selected layer attributes list.\n     * @public\n     */\n    this.fields = [];\n\n    /**\n     * Possible values for all fields of the selected layer.\n     * @public\n     */\n    this.fieldValues = [];\n\n    /**\n     * Fields page counter\n     * @public\n     */\n    this.currentFieldsPage = 0;\n\n    /**\n     * Field values page counter.\n     * @public\n     */\n    this.currentValuesPage = 0;\n\n    /**\n     * Table view results page counter.\n     * @public\n     */\n    this.resultsPage = 0;\n\n    /**\n     * KML layers added to map.\n     * @public\n     */\n    this.kmlLayers = [];\n  }\n\n  /**\n   * This function creates the view\n   *\n   * @public\n   * @function\n   * @param {M.Map} map to add the control\n   * @api stable\n   */\n  createView(map) {\n    this.map = map;\n    return new Promise((success, fail) => {\n      this.createInitialView(map);\n      const html = M.template.compileSync(template);\n      html.querySelector('#m-filteredsearch-options-container').appendChild(this.initialView);\n      this.filterResults = M.template.compileSync(seeResults);\n      this.valuesTemplate = M.template\n        .compileSync(valuesTemplate, { jsonp: true, vars: { values: [] } });\n      this.addEvents(html);\n      this.setInitialButtons(html);\n      this.kmlLayers = this.map.getKML().map((layer) => {\n        return { layer, loaded: false };\n      });\n      success(html);\n    });\n  }\n\n  /**\n   * Adds event listeners to several HTML elements.\n   * @public\n   * @function\n   * @param {HTML Element} html - 'filteredsearch.html' template\n   * @api\n   */\n  addEvents(html) {\n    this.initialView.querySelector('#m-filteredsearch-layers-select').addEventListener('change', (evt) => {\n      this.showLayerFields(evt.target[evt.target.selectedIndex].getAttribute('name'));\n    });\n    this.initialView.querySelector('#m-filteredsearch-method-select').addEventListener('change', (evt) => {\n      this.selectionMethod = evt.target.value;\n    });\n    html.querySelectorAll('#m-filteredsearch-operators-container>button').forEach((element) => {\n      element.addEventListener('click', e => this.operatorClick(e, element));\n    });\n    html.querySelectorAll('#m-filteredsearch-options-buttons>button')\n      .forEach(btn => btn.addEventListener('click', (e) => {\n        this.processQuery(e);\n      }));\n    html.querySelector('#m-filteredsearch-query-container>textarea').addEventListener('input', (e) => {\n      this.sqlQuery = e.target.value.replace(/_/g, '.').replace(/%/g, '.*');\n      this.setInitialButtons(document.querySelector('#m-filteredsearch-options-buttons'));\n    });\n    // checks if KML layers are loaded and saves flag on this.kmlLayers object\n    this.map.getKML().forEach((kmlLayer) => {\n      kmlLayer.on(M.evt.LOAD, () => {\n        this.kmlLayers.filter((layer) => {\n          return layer.layer === kmlLayer;\n        })[0].loaded = true;\n      });\n    });\n  }\n\n  /**\n   * Creates initialview.html template dinamically.\n   * @public\n   * @function\n   * @api\n   * @param {Map} map\n   */\n  createInitialView(map) {\n    const options = {\n      jsonp: true,\n      vars: {\n        layers: map.getLayers()\n          .filter(layer => layer instanceof M.layer.Vector && layer.name !== '__draw__'),\n      },\n    };\n    this.initialView = M.template.compileSync(initialView, options);\n    this.operators.forEach((operator) => {\n      const btnTextNode = document.createTextNode(operator);\n      const buttonNode = document.createElement('button');\n      buttonNode.appendChild(btnTextNode);\n      this.initialView.querySelector('#m-filteredsearch-operators-container').appendChild(buttonNode);\n    });\n  }\n\n  /**\n   * Turns sql-like query string into Mapea filter.\n   * @public\n   * @function\n   * @api\n   * @param { String } stringQ - sql-like query\n   */\n  turnStringIntoQuery(stringQ) {\n    let pieces = [];\n    let mapeaFilter;\n    const nextOperator = this.findNextOperator(stringQ);\n    if (!this.isThisTheLastOperator(stringQ, nextOperator)) {\n      pieces = this.saveOperands(stringQ, nextOperator.indexes);\n      for (let i = 0; i < pieces.length; i += 1) {\n        pieces[i] = this.turnStringIntoQuery(pieces[i]);\n      }\n    } else {\n      pieces[0] = stringQ.substring(0, nextOperator.indexes[0]).trim();\n      pieces[1] = stringQ.substring(nextOperator.indexes[1] + 1).trim();\n      mapeaFilter = this.translateOrderToQuery(nextOperator.operator, pieces);\n      return mapeaFilter;\n    }\n\n    mapeaFilter = this.translateOrderToQuery(nextOperator.operator, pieces);\n\n    return mapeaFilter;\n  }\n\n  /**\n   * Finds the next most important operator on a string.\n   * @public\n   * @function\n   * @api\n   * @param {String} query - query string\n   */\n  findNextOperator(query) { // TODO: shorten this method\n    let operator = '';\n    const indexes = [];\n\n    // First, and/or search (outside parentheses)\n    for (let i = 0; i < query.length; i += 1) {\n      // avoids searching inside ()\n      if (query.charAt(i) === '(') {\n        const closingParenthesesIndex = this.findClosingParentheses(query, i);\n        i = closingParenthesesIndex + 1;\n      }\n\n      if ((query.substring(i, i + 3) === 'and' &&\n          !this.operatorInWord(query, [i, i + 2])) ||\n        (query.substring(i, i + 2) === 'or' &&\n          !this.operatorInWord(query, [i, i + 1]))\n      ) {\n        if (query.substring(i, i + 3) === 'and') {\n          operator = query.substring(i, i + 3);\n          indexes[0] = i;\n          indexes[1] = i + 2;\n        } else { // or\n          operator = query.substring(i, i + 2);\n          indexes[0] = i;\n          indexes[1] = i + 1;\n        }\n        i = query.length;\n      }\n    }\n\n    if (operator === '') {\n      for (let i = 0; i < query.length; i += 1) {\n        // avoids searching inside ()\n        if (query.charAt(i) === '(') {\n          const closingParenthesesIndex = this.findClosingParentheses(query, i);\n          i = closingParenthesesIndex + 1;\n        }\n\n        if ((query.substring(i, i + 3) === 'not' &&\n            !this.operatorInWord(query, [i, i + 2])) ||\n          (query.substring(i, i + 4) === 'like' &&\n            !this.operatorInWord(query, [i, i + 3]))) {\n          if (query.substring(i, i + 3) === 'not') {\n            operator = query.substring(i, i + 3);\n            indexes[0] = i;\n            indexes[1] = i + 2;\n          } else { // like\n            operator = query.substring(i, i + 4);\n            indexes[0] = i;\n            indexes[1] = i + 3;\n          }\n          i = query.length;\n        }\n      }\n    }\n\n    if (operator === '') {\n      for (let i = 0; i < query.length; i += 1) {\n        // avoids searching inside ()\n        if (query.charAt(i) === '(') {\n          const closingParenthesesIndex = this.findClosingParentheses(query, i);\n          i = closingParenthesesIndex + 1;\n        }\n\n        if (query.substring(i, i + 2) === '<=' ||\n          query.substring(i, i + 2) === '>=' ||\n          query.substring(i, i + 2) === '<>') {\n          operator = query.substring(i, i + 2);\n          indexes[0] = i;\n          indexes[1] = i + 1;\n          i = query.length;\n        } else if (query.charAt(i) === '=' || query.charAt(i) === '<' ||\n          query.charAt(i) === '>') {\n          operator = query.charAt(i);\n          indexes[0] = i;\n          indexes[1] = i;\n          i = query.length;\n        }\n      }\n    }\n\n    return { operator, indexes };\n  }\n\n  /**\n   * Checks if a string has any operators other than the given one.\n   * @function\n   * @public\n   * @param {String} query\n   * @param {String} operator\n   * @api\n   */\n  isThisTheLastOperator(query, operator) {\n    let isLastOp = true;\n    const ops = ['=', '<=', '>=', '<>', '(', 'and', 'or', 'not', 'like'];\n    const cutQuery = `${query.substring(0, operator.indexes[0])}${query.substring(operator.indexes[1] + 1)}`;\n    if (\n      ops.some((v) => {\n        const operatorContainedInQuery = cutQuery.indexOf(v) >= 0;\n        const possibleOperatorIndexes = [cutQuery.indexOf(v),\n          (cutQuery.indexOf(v) + ops[ops.indexOf(v)].length) - 1,\n        ];\n        const operatorNotInWord = !this.operatorInWord(cutQuery, possibleOperatorIndexes);\n        return operatorContainedInQuery && operatorNotInWord;\n      })) {\n      isLastOp = false;\n    }\n    return isLastOp;\n  }\n\n  /**\n   * Splits string into operands by operator position.\n   * @public\n   * @function\n   * @api\n   * @param {String} query - query string\n   * @param {String} operator - calculation operator\n   * @param {Array} startEndIndexes - operands limits\n   */\n  saveOperands(query, startEndIndexes) {\n    let operands = [];\n    const startSplitIndex = startEndIndexes[0];\n    const endSplitIndex = startEndIndexes[1];\n\n    if (startSplitIndex !== 0) {\n      operands.push(query.substring(0, startSplitIndex).trim());\n    }\n    operands.push(query.substring(endSplitIndex + 1).trim());\n\n    operands = operands.map((operand) => {\n      let newOperand = operand;\n      if (operand[0] === '(') {\n        newOperand = newOperand.substring(1);\n      }\n      if (operand[operand.length - 1] === ')') {\n        newOperand = newOperand.substring(0, operand.length - 1);\n      }\n      return newOperand;\n    });\n\n    return operands;\n  }\n\n  /**\n   * Turns simple query expression into Mapea filter.\n   * @public\n   * @function\n   * @param {String} operator - operator to apply on split query\n   * @param { Array < String > } pieces - expression operands\n   * @api\n   */\n  translateOrderToQuery(operator, pieces) {\n    let mFilter = '';\n\n    switch (operator) {\n      case '=':\n        mFilter = M.filter.EQUAL(...pieces);\n        break;\n      case '<>':\n        const attr = pieces[0];\n        const val = pieces[1];\n        mFilter = new M.filter.Function((feature) => {\n          return feature.getAttribute(attr) !== val;\n        });\n        break;\n      case '<':\n        mFilter = M.filter.LT(...pieces);\n        break;\n      case '>':\n        mFilter = M.filter.GT(...pieces);\n        break;\n      case '<=':\n        mFilter = M.filter.LTE(...pieces);\n        break;\n      case '>=':\n        mFilter = M.filter.GTE(...pieces);\n        break;\n      case 'and':\n        mFilter = M.filter.AND([...pieces]);\n        break;\n      case 'or':\n        mFilter = M.filter.OR([...pieces]);\n        break;\n      case 'like':\n        mFilter = M.filter.LIKE(...pieces);\n        break;\n      case 'not':\n        mFilter = M.filter.NOT(...pieces);\n        break;\n      default:\n    }\n\n    return mFilter;\n  }\n\n  /**\n   * Finds the closing parentheses of a pair.\n   * @public\n   * @function\n   * @api\n   * @param {String} query - query string where the parentheses set is found\n   * @param { Number } openingIndex - opening parentheses index\n   */\n  findClosingParentheses(query, openingIndex) {\n    let closingParenthesesIndex;\n    let parenthesesCounter = 0;\n    for (let i = openingIndex + 1; i < query.length; i += 1) {\n      if (parenthesesCounter === 0 && query.charAt(i) === ')') {\n        closingParenthesesIndex = i;\n        i = query.length;\n      } else if (query.charAt(i) === '(') {\n        parenthesesCounter += 1;\n      } else if (query.charAt(i) === ')' && parenthesesCounter !== 0) {\n        parenthesesCounter -= 1;\n      }\n    }\n    return closingParenthesesIndex;\n  }\n\n  /**\n   * Checks if given operator is part of a word or a real operator.\n   * Returns true if it's a real operator.\n   * @public\n   * @function\n   * @api\n   * @param {String} query - string in which the operator candidate is found\n   * @param { Array < String > } operatorIndexes - start and end operator indexes on query\n   */\n  operatorInWord(query, operatorIndexes) {\n    let inWord = false;\n    const startSplitIndex = operatorIndexes[0];\n    const endSplitIndex = operatorIndexes[1];\n    const previousChar = query[startSplitIndex - 1];\n    const nextChar = query[endSplitIndex + 1];\n\n    if (((previousChar !== undefined) && (previousChar.match(/[a-z]/i))) ||\n      ((nextChar !== undefined) && (nextChar.match(/[a-z]/i)))) {\n      inWord = true;\n    }\n\n    return inWord;\n  }\n\n  /**\n   * Checks if a parentheses in a string belongs to a Mapea filter method.\n   * @public\n   * @function\n   * @param { String } query - complete or partial query string\n   * @param {Number} index - indexOf first parentheses on string\n   * @api\n   */\n  isMapeaFilterParentheses(query, index) {\n    const twoLettersOperators = ['OR', 'LT', 'GT'];\n    const threeLettersOperators = ['AND', 'NOT', 'LTE', 'GTE'];\n    const position = index;\n    let isMFilterPar = false;\n\n    if ((((position - 11 !== -1) && (query.substring(position - 11, position - 2) === 'M.filter.')) &&\n        twoLettersOperators.includes(query.substring(position - 2, position))) ||\n      (((position - 12 !== -1) && (query.substring(position - 12, position - 3) === 'M.filter.')) &&\n        threeLettersOperators.includes(query.substring(position - 3, position))) ||\n      (((position - 13 !== -1) && (query.substring(position - 13, position - 4) === 'M.filter.')) &&\n        (query.substring(position - 4, position) === 'LIKE')) ||\n      (((position - 14 !== -1) && (query.substring(position - 14, position - 5) === 'M.filter.')) &&\n        (query.substring(position - 5, position) === 'EQUAL'))) {\n      isMFilterPar = true;\n    }\n\n    return isMFilterPar;\n  }\n\n  /**\n   * Turns new given filter into a filter that combines the already applied filter and the new one.\n   * @public\n   * @function\n   * @param { M.Filter } mapeaFilter - new query filter\n   * @api\n   */\n  getMethodFilter(mapeaFilter) {\n    let combinedFilter;\n    switch (this.selectionMethod) {\n      case 'Nueva selección':\n        combinedFilter = mapeaFilter;\n        break;\n      case 'Selección sobre anterior':\n        if (this.oldFilter !== undefined) {\n          // AND nueva query\n          combinedFilter = M.filter.AND([this.oldFilter, mapeaFilter]);\n        } else {\n          M.dialog.error('No existe una consulta previa.');\n        }\n        break;\n      case 'Eliminar sobre anterior':\n        if (this.oldFilter !== undefined) {\n          // AND NOT nueva query\n          combinedFilter = M.filter.AND([this.oldFilter, M.filter.NOT(mapeaFilter)]);\n        } else {\n          M.dialog.error('No existe una consulta previa.');\n        }\n        break;\n      case 'Añadir sobre anterior':\n        if (this.oldFilter !== undefined) {\n          // OR nueva query\n          combinedFilter = M.filter.OR([this.oldFilter, mapeaFilter]);\n        } else {\n          M.dialog.error('No existe una consulta previa.');\n        }\n        break;\n      default:\n        M.dialog.error('Debe seleccionar un método.');\n        break;\n    }\n\n    return combinedFilter;\n  }\n\n  /**\n   * Performs button action onClick.\n   * @public\n   * @function\n   * @param {Event} e - triggering event\n   * @api\n   */\n  processQuery(e) {\n    const optsContainer = document.querySelector('#m-filteredsearch-options-container');\n    const btnContainer = document.querySelector('#m-filteredsearch-options-buttons');\n    const action = e.target.getAttribute('id');\n\n    switch (action) {\n      case 'aceptar-btn':\n        if (this.layer_ === undefined) {\n          M.dialog.error('Debe seleccionar una capa.');\n        } else {\n          if (this.selectionMethod === 'Nueva selección') {\n            this.oldFilter = undefined;\n            this.oldLayer = undefined;\n          }\n          this.setNewFilter();\n          if (this.isValidQuery && this.selectionMethod !== undefined) this.setOkButtons();\n        }\n        break;\n      case 'limpiar-busqueda-btn':\n        this.cleanSearch();\n        break;\n      case 'limpiar-filtro-btn':\n        this.layer_.removeFilter();\n        this.setInitialButtons(btnContainer);\n        break;\n      case 'vertabla-btn':\n        this.saveResultsOnTable();\n        optsContainer.innerHTML = '';\n        optsContainer.appendChild(this.filterResults);\n        this.setTableViewButtons(btnContainer);\n        break;\n      case 'exportar-btn':\n        this.exportResults();\n        break;\n      case 'guardar-btn':\n        if (this.isValidQuery) {\n          this.myqueries.push({\n            query: this.sqlQuery,\n            layer: this.layer_,\n          });\n        } else {\n          M.dialog.error('Consulta inválida.');\n        }\n        break;\n      case 'misconsultas-btn':\n        this.myQueriesClick(optsContainer);\n        this.showMyQueriesViewButtons(btnContainer);\n        break;\n      case 'volver-btn':\n        optsContainer.innerHTML = '';\n        optsContainer.appendChild(this.initialView);\n        this.setOkButtons(); // TODO: check if there's a filter applied to show data btns or not\n        document.querySelector('#guardar-btn').style.display = 'none';\n        break;\n      case 'eliminar-btn':\n        // this.deleteFromButton();\n        break;\n      default:\n        console.log('Este botón no tiene funcionalidad.');\n        break;\n    }\n  }\n\n  /**\n   * Shows saved queries view (saved queries with filter activation on click).\n   * @public\n   * @function\n   * @api\n   * @param {HTML Element} central panel\n   */\n  myQueriesClick(container) {\n    const optsContainer = container;\n    optsContainer.innerHTML = '';\n\n    this.compileMyQueriesTemplate();\n\n    this.addSavedQueryClick();\n\n    optsContainer.appendChild(this.savedQueriesView);\n  }\n\n  /**\n   * Adds event listener for click on saved query table cell.\n   * @public\n   * @function\n   * @api\n   */\n  addSavedQueryClick() {\n    this.savedQueriesView.querySelectorAll('td').forEach((td, idx) => {\n      td.addEventListener('click', (e) => {\n        this.savedQueryClicked(e, td, idx);\n      });\n    });\n  }\n\n  /**\n   * Deletes previous filters and applies clicked filter to map.\n   * Adds focus to clicked query cell.\n   * Shows delete query button.\n   * @param {Event} e - triggering event\n   * @param {HTML Element} td - clicked query table cell\n   * @param {Number} idx - this.myqueries clicked query index\n   */\n  savedQueryClicked(e, td, idx) {\n    this.deleteAppliedFilters();\n    this.clickedQuery = this.myqueries[idx];\n    this.mapeaFilterQuery = this.turnStringIntoQuery(this.clickedQuery.query);\n    this.layer_ = this.clickedQuery.layer;\n    this.layer_.setFilter(this.mapeaFilterQuery);\n\n    Array.prototype.forEach.call(\n      e.target.parentNode.parentNode.parentNode.children[0].children,\n      (row) => {\n        Array.prototype.forEach.call(row.children, (rowCell) => {\n          rowCell.classList.remove('focus');\n        });\n      },\n    );\n    e.target.classList.add('focus');\n\n    const deleteBtn = document.querySelector('#m-filteredsearch-options-buttons').querySelector('#eliminar-btn');\n    deleteBtn.style.display = 'inline';\n    deleteBtn.onclick = () => {\n      this.deleteSavedQuery(td, idx);\n      this.compileMyQueriesTemplate();\n      this.addSavedQueryClick();\n      document.querySelector('#m-filteredsearch-options-container').appendChild(this.savedQueriesView);\n    };\n  }\n\n  /**\n   * Deletes saved query from this.myqueries.\n   * @public\n   * @function\n   * @param {HTML Element} td - results table cell with query\n   * @param {Number} idx - saved queries array query index\n   * @api\n   */\n  deleteSavedQuery(td, idx) {\n    this.myqueries.splice(idx, 1);\n    td.parentNode.remove();\n    document.querySelector('#m-filteredsearch-options-buttons').querySelector('#eliminar-btn').style.display = 'none';\n    this.sqlQuery = '';\n    this.layer_.removeFilter();\n    if (this.myqueries.length === 0) {\n      document.querySelector('#m-filteredsearch-options-container').innerHTML = 'No hay consultas guardadas.';\n    }\n  }\n\n  /**\n   * Compiles savedQueries template with this.myqueries data.\n   * @public\n   * @function\n   * @api\n   */\n  compileMyQueriesTemplate() {\n    if (this.savedQueriesView !== undefined) {\n      let child = this.savedQueriesView.lastElementChild;\n      while (child) {\n        child.remove();\n        child = this.savedQueriesView.lastElementChild;\n      }\n    }\n\n    this.mySqlQueries = this.myqueries.map((q) => {\n      const newQuery = q;\n      newQuery.query = q.query.replace(/\\.\\*/g, '%').replace(/\\./g, '_');\n      return newQuery;\n    });\n    this.savedQueriesView = M.template.compileSync(savedQueries, {\n      vars: { queries: this.mySqlQueries },\n    });\n  }\n\n  /**\n   * Resets every layer to initial filter (null).\n   * @public\n   * @function\n   * @api\n   */\n  deleteAppliedFilters() {\n    const vectorLayers = this.map.getWFS()\n      .concat(this.map.getKML()\n        .concat(this.map.getLayers().filter((layer) => {\n          return layer.type === 'GeoJSON';\n        })));\n    vectorLayers.forEach((layer) => {\n      if (layer.getFilter !== null) layer.removeFilter();\n    });\n  }\n\n  /**\n   * Sets new filter on layer.\n   * @public\n   * @function\n   * @api\n   */\n  setNewFilter() {\n    // Sets new filter\n    if (this.sqlQuery === '') {\n      M.dialog.error('Debe introducir una consulta.');\n      // Resets last saved query\n      this.mapeaFilterQuery = this.oldFilter;\n      this.layer_ = this.oldLayer;\n    } else if (this.oldLayer !== undefined && this.oldLayer !== this.layer_) {\n      M.dialog.error('No se puede aplicar una consulta combinada sobre dos capas diferentes.');\n      // Resets last saved query\n      this.mapeaFilterQuery = this.oldFilter;\n      this.layer_ = this.oldLayer;\n    } else {\n      // Gets new query\n      let tryFilter;\n\n      // FIXME: Trying to do nothing if filter doesn't get set on map\n      // Cases visibility and description of 'Arboleda' layer never enter catch. Doesn't work right.\n      try {\n        tryFilter = this.turnStringIntoQuery(this.sqlQuery);\n        tryFilter = this.getMethodFilter(tryFilter);\n        this.layer_.setFilter(tryFilter);\n        if (this.layer_.getFilter() !== null) {\n          this.mapeaFilterQuery = tryFilter;\n          this.oldFilter = this.mapeaFilterQuery;\n          this.oldLayer = this.layer_;\n          this.isValidQuery = true;\n        } else {\n          this.isValidQuery = false;\n          throw new Error('Error: Filtro inválido');\n        }\n      } catch (err) {\n        this.isValidQuery = false;\n        M.dialog.error('No se ha podido aplicar el filtro.');\n      }\n    }\n  }\n\n  /**\n   * Downloads .csv file with results data.\n   * @public\n   * @function\n   * @api\n   */\n  exportResults() {\n    const features = this.layer_.getFeatures();\n    if (features.length > 0) {\n      const csvString = this.dataToCsv(features);\n      this.downloadCsv(csvString);\n    } else {\n      M.dialog.error('No hay datos para exportar.');\n    }\n  }\n\n  /**\n   * Saves features attributes on csv string.\n   * @public\n   * @function\n   * @param {M.feature} features - query results features\n   * @api\n   */\n  dataToCsv(features) {\n    let csv = '';\n    const featureKeys = Object.keys(features[0].getAttributes());\n    featureKeys.forEach((key) => { csv += `${key},`; });\n    csv = `${csv.substring(0, csv.length - 1)}\\n`; // deletes last ',' and adds line break\n\n    features.forEach((feature) => {\n      const featureAttrs = feature.getAttributes(); // {cod: '11', nombre: 'Cádiz'}\n      featureKeys.forEach((key) => {\n        // only escape() if string has more than letters and spaces\n        // substitute 'escape' (deprecated) for own escape method\n        // csv += `${escape(featureAttrs[key])},`;\n        csv += featureAttrs[key];\n        csv += ',';\n      });\n      csv = `${csv.substring(0, csv.length - 1)}\\n`; // deletes last ',' and adds line break\n    });\n    csv = csv.substring(0, csv.length - 1); // deletes last line break\n    return csv;\n  }\n\n  /**\n   * Creates hidden link element and clicks it to download given csv data.\n   * @public\n   * @function\n   * @api\n   * @param {String} csvdata - csv data with query results\n   */\n  downloadCsv(csvdata) {\n    const fileName = 'queryresults.csv';\n    const fileUrl = `data:text/csv;charset=utf-8,${encodeURI(csvdata)}`;\n    const hiddenLink = document.createElement('a');\n    hiddenLink.href = fileUrl;\n    hiddenLink.download = fileName;\n    hiddenLink.click();\n  }\n\n  /**\n   * Shows initial view buttons.\n   * @public\n   * @function\n   * @param {HTML Element} panelContainer - Buttons div container\n   * @api\n   */\n  setInitialButtons(panelContainer) {\n    const btnContainer = panelContainer;\n    btnContainer.querySelector('#volver-btn').style.display = 'none';\n    btnContainer.querySelector('#aceptar-btn').style.display = 'inline';\n    btnContainer.querySelector('#limpiar-busqueda-btn').style.display = 'inline';\n    btnContainer.querySelector('#limpiar-filtro-btn').style.display = 'inline';\n    btnContainer.querySelector('#vertabla-btn').style.display = 'none';\n    btnContainer.querySelector('#exportar-btn').style.display = 'none';\n    btnContainer.querySelector('#guardar-btn').style.display = 'none';\n    btnContainer.querySelector('#misconsultas-btn').style.display = 'inline';\n    btnContainer.querySelector('#eliminar-btn').style.display = 'none';\n  }\n\n  /**\n   * Shows buttons for view after a filter is set.\n   * @public\n   * @function\n   * @api\n   */\n  setOkButtons() {\n    document.querySelector('#volver-btn').style.display = 'none';\n    document.querySelector('#aceptar-btn').style.display = 'inline';\n    document.querySelector('#limpiar-busqueda-btn').style.display = 'inline';\n    document.querySelector('#limpiar-filtro-btn').style.display = 'inline';\n    document.querySelector('#vertabla-btn').style.display = 'inline';\n    document.querySelector('#exportar-btn').style.display = 'inline';\n    document.querySelector('#guardar-btn').style.display = 'inline';\n    document.querySelector('#misconsultas-btn').style.display = 'inline';\n  }\n\n  /**\n   * Hides some buttons for \"Results table\" view.\n   * @public\n   * @function\n   * @param {HTML Element} container - Buttons div container\n   * @api\n   */\n  setTableViewButtons(container) {\n    const btnContainer = container;\n    btnContainer.querySelector('#volver-btn').style.display = 'inline';\n    btnContainer.querySelector('#aceptar-btn').style.display = 'none';\n    btnContainer.querySelector('#limpiar-busqueda-btn').style.display = 'none';\n    btnContainer.querySelector('#limpiar-filtro-btn').style.display = 'none';\n    btnContainer.querySelector('#vertabla-btn').style.display = 'none';\n    btnContainer.querySelector('#exportar-btn').style.display = 'none';\n    btnContainer.querySelector('#guardar-btn').style.display = 'none';\n    btnContainer.querySelector('#misconsultas-btn').style.display = 'none';\n  }\n\n  /**\n   * Hides all unnecessary buttons for MyQueries view.\n   * @public\n   * @function\n   * @api\n   * @param {HTML Element} container - Buttons div container\n   */\n  showMyQueriesViewButtons(container) {\n    const btnContainer = container;\n    btnContainer.querySelector('#volver-btn').style.display = 'inline';\n    btnContainer.querySelector('#aceptar-btn').style.display = 'none';\n    btnContainer.querySelector('#limpiar-busqueda-btn').style.display = 'none';\n    btnContainer.querySelector('#limpiar-filtro-btn').style.display = 'none';\n    btnContainer.querySelector('#vertabla-btn').style.display = 'none';\n    btnContainer.querySelector('#exportar-btn').style.display = 'none';\n    btnContainer.querySelector('#guardar-btn').style.display = 'none';\n    btnContainer.querySelector('#misconsultas-btn').style.display = 'none';\n  }\n\n  /**\n   * Cleans input selections.\n   * @public\n   * @function\n   * @api\n   */\n  cleanSearch() {\n    document.querySelector('.filtered-search-panel').querySelector('textarea').value = '';\n    document.querySelector('#m-filteredsearch-method-select').value = 'Seleccione método.';\n    this.selectionMethod = '';\n    this.sqlQuery = '';\n    document.querySelector('#m-filteredsearch-layers-select').querySelector('#layers0').selected = true;\n    document.querySelector('#m-filteredsearch-fields').innerHTML = '<p class=\"m-filteredsearch-headers\">Campos</p>';\n    document.querySelector('#m-filteredsearch-values').innerHTML = '<p class=\"m-filteredsearch-headers\">Valores</p>';\n  }\n\n  /**\n   * Shows expected results page\n   * @public\n   * @function\n   * @param {Array <Array>} pages - results divided in pages\n   * @api\n   */\n  showTableViewPage(pages) {\n    // empty results table\n    this.filterResults.querySelector('#queryresults').innerHTML = '';\n\n    // Get layer attributes and show column titles and pagination buttons\n    const attributes = this.layer_.getFeatures()[0].getAttributes();\n    let newLine = document.createElement('tr');\n    Object.keys(attributes).forEach((attributeKey) => {\n      const newTitleCell = document.createElement('th');\n      const cellText = document.createTextNode(attributeKey);\n      newTitleCell.appendChild(cellText);\n      newLine.appendChild(newTitleCell);\n    });\n    this.filterResults.querySelector('#queryresults').appendChild(newLine);\n    this.filterResults.querySelector('#paginationbuttons>#pageNumBtn').innerHTML = `${this.resultsPage + 1} de ${pages.length}`;\n\n    // Show every result on a new table row\n    const currentPageFeatures = pages[this.resultsPage];\n    currentPageFeatures.forEach((filteredFeature) => {\n      newLine = document.createElement('tr');\n      const filteredAttributes = filteredFeature.getAttributes();\n      Object.keys(filteredAttributes).forEach((key) => {\n        const newCell = document.createElement('td');\n        // Commented code in case table field needs to show table\n        // const htmlContent = document.createElement('div');\n        // htmlContent.innerHTML = filteredAttributes[key];\n        // newCell.appendChild(htmlContent);\n        const txt = document.createTextNode(filteredAttributes[key].toString());\n        newCell.appendChild(txt);\n        newLine.appendChild(newCell);\n      });\n      this.filterResults.querySelector('#queryresults').appendChild(newLine);\n    });\n  }\n\n  /**\n   * Creates a table row for every result after filtering layer features.\n   * @function\n   * @public\n   * @api\n   */\n  saveResultsOnTable() {\n    if (this.layer_.getFeatures().length > 0) {\n      // Divide filter results into pages & show current page\n      const pages = this.divideList(this.layer_.getFeatures());\n      this.showTableViewPage(pages);\n\n      // Page turning\n      this.filterResults.querySelectorAll('#paginationbuttons>button').forEach((btn) => {\n        btn.addEventListener('click', (e) => {\n          if (e.target.id === 'prevBtn') {\n            this.resultsPage = this.resultsPage > 0 ? this.resultsPage -= 1 : this.resultsPage;\n          } else {\n            this.resultsPage = this.resultsPage < pages.length - 1 ?\n              this.resultsPage += 1 : this.resultsPage;\n          }\n          this.showTableViewPage(pages);\n        });\n      });\n    } else {\n      this.filterResults.innerHTML = 'No hay entidades con las caracerísticas indicadas.';\n    }\n  }\n\n  /**\n   * Saves clicked button operator in query and adds it to textarea.\n   * @public\n   * @function\n   * @param {Event} e\n   * @param {HTML Element} btn\n   * @api\n   */\n  operatorClick(e, btn) {\n    const txtarea = document.querySelector('.filtered-search-panel').querySelector('textarea');\n    switch (btn.innerHTML) {\n      case '()':\n        if (this.parenthesesClick === 0) {\n          txtarea.value += '(';\n          this.sqlQuery += '(';\n          this.parenthesesClick = 1;\n        } else {\n          txtarea.value += ')';\n          this.sqlQuery += ')';\n          this.parenthesesClick = 0;\n        }\n        break;\n      case '&#61;':\n        txtarea.value += ' = ';\n        this.sqlQuery += ' = ';\n        break;\n      case '&lt;':\n        txtarea.value += ' < ';\n        this.sqlQuery += ' < ';\n        break;\n      case '&gt;':\n        txtarea.value += ' > ';\n        this.sqlQuery += ' > ';\n        break;\n      case '&lt;&gt;':\n        txtarea.value += ' <> ';\n        this.sqlQuery += ' <> ';\n        break;\n      case '&gt;=':\n        txtarea.value += ' >= ';\n        this.sqlQuery += ' >= ';\n        break;\n      case '&lt;=':\n        txtarea.value += ' <= ';\n        this.sqlQuery += ' <= ';\n        break;\n      case '_': // sql _ -> regexp .\n        txtarea.value += '_';\n        this.sqlQuery += '.';\n        break;\n      case '%': // sql % -> regexp .*\n        txtarea.value += '%';\n        this.sqlQuery += '.*';\n        break;\n      default:\n        txtarea.value += ` ${btn.innerHTML.toLowerCase()} `;\n        this.sqlQuery += ` ${btn.innerHTML.toLowerCase()} `;\n    }\n  }\n\n  /**\n   * Shows selected layer fields list first page (if layer is loaded).\n   * @public\n   * @function\n   * @param { String } layerName - selected layer name\n   * @api\n   */\n  showLayerFields(layerName) {\n    // finds and saves param layerName\n    if (!M.utils.isNullOrEmpty(layerName)) {\n      this.layer_ = this.hasLayer_(layerName)[0];\n    }\n\n    if (this.isLayerLoaded(this.layer_)) {\n      this.fieldValues = [];\n      const features = this.layer_.getFeatures();\n\n      // clears previous query\n      this.oldFilter = this.mapeaFilterQuery;\n      this.oldLayer = this.layer_;\n      document.querySelector('.filtered-search-panel').querySelector('textarea').value = '';\n      this.sqlQuery = '';\n      this.mapeaFilterQuery = null;\n\n      // if there's features on this.layer_, save them and their values on arrays\n      if (!M.utils.isNullOrEmpty(features)) {\n        this.fields = Object.keys(features[0].getAttributes());\n        features.forEach((feature) => {\n          const properties = Object.values(feature.getAttributes());\n          if (!M.utils.isNullOrEmpty(properties)) {\n            this.fieldValues.push(properties);\n          }\n        });\n\n        this.fieldsPages = this.divideList(this.fields);\n        const fields = this.fieldsPages[0];\n\n        const options = { jsonp: true, vars: { fields } };\n        this.fieldsTemplate = M.template.compileSync(fieldsTemplate, options);\n        this.fieldsTemplate.querySelector('#pageNumBtn').innerHTML = `1 de ${this.fieldsPages.length}`;\n        document.querySelector('#m-filteredsearch-fields').innerHTML = '<p class=\"m-filteredsearch-headers\">Campos</p>';\n        document.querySelector('#m-filteredsearch-fields').appendChild(this.fieldsTemplate);\n\n        this.showFields();\n        this.addpageBtnEvt();\n      }\n    } else {\n      M.dialog.error('La capa no se ha cargado todavía.');\n    }\n  }\n\n  /**\n   * Checks if layer is loaded.\n   * @public\n   * @function\n   * @param {Mapea Layer} layer - clicked layer on select menu\n   * @api\n   */\n  isLayerLoaded(layer) {\n    let isLoaded = false;\n    if (layer.type !== 'KML' && layer.getImpl().isLoaded()) {\n      isLoaded = true;\n    } else if (\n      this.kmlLayers.filter((l) => { return l.layer === layer; })[0].loaded) {\n      isLoaded = true;\n    }\n    return isLoaded;\n  }\n\n  /**\n   * Adds click event on each field.\n   * Adds field name to query, finds possible field values and shows them and changes cell focus.\n   * @public\n   * @function\n   * @api\n   */\n  showFields() {\n    document.querySelector('#m-filteredsearch-fields').querySelectorAll('td').forEach((cell) => {\n      const values = [];\n      const fieldIndex = this.fields.indexOf(cell.innerHTML);\n      this.fieldValues.forEach((element) => {\n        values.push(element[fieldIndex]);\n      });\n      cell.addEventListener('click', (e) => {\n        const txtarea = document.querySelector('.filtered-search-panel').querySelector('textarea');\n        txtarea.value += e.target.innerHTML;\n        this.sqlQuery += e.target.innerHTML;\n        this.selectField(values);\n        // sets 'focus'\n        Array.prototype.forEach.call(\n          e.target.parentNode.parentNode.parentNode.children[0].children,\n          (row) => {\n            Array.prototype.forEach.call(row.children, (rowCell) => {\n              rowCell.classList.remove('focus');\n            });\n          },\n        );\n        e.target.classList.add('focus');\n      });\n    });\n  }\n\n  /**\n   * Adds pagination buttons onclick events.\n   * @public\n   * @function\n   * @api\n   */\n  addpageBtnEvt() {\n    this.fieldsTemplate.querySelectorAll('#m-attributetable-tfoot>button').forEach((element) => {\n      element.addEventListener('click', e => this.changePage(e, 'fields', this.fieldsPages.length));\n    });\n    this.valuesTemplate.querySelectorAll('#m-attributetable-tfoot>button').forEach((element) => {\n      element.addEventListener('click', e => this.changePage(e, 'values', this.valuesPages.length));\n    });\n  }\n\n  /**\n   * Divides list items in groups of 5 items.\n   * @public\n   * @function\n   * @api\n   * @param {List} items - items (fields/values) to separate in pages\n   * @returns {Array <Array>} pages - each inside array has n items\n   */\n  divideList(items) {\n    const numberOfItemsPerPage = 5;\n    const pages = [];\n    let firstItem = 0;\n    while (firstItem < items.length) {\n      const newPage = [];\n      for (let i = firstItem; i < firstItem + numberOfItemsPerPage; i += 1) {\n        newPage.push(items[i]);\n        if (i + 1 === items.length) {\n          i = firstItem + numberOfItemsPerPage;\n        }\n      }\n      pages.push(newPage);\n      firstItem += numberOfItemsPerPage;\n    }\n    return pages;\n  }\n\n  /**\n   * Changes currentPage number and shows page results on fields/values list.\n   * @public\n   * @function\n   * @api\n   * @param {Event} e - event triggering button\n   * @param {String} fieldsOrValues - container key (either 'fields' or 'values')\n   * @param {Number} numberOfPages\n   */\n  changePage(e, fieldsOrValues, numberOfPages) {\n    let currentPage = fieldsOrValues === 'fields' ? this.currentFieldsPage : this.currentValuesPage;\n\n    if (e.target.id === 'prevBtn') {\n      currentPage = currentPage > 0 ? currentPage -= 1 : currentPage;\n    } else {\n      currentPage = currentPage < numberOfPages - 1 ? currentPage += 1 : currentPage;\n    }\n\n    if (fieldsOrValues === 'fields') {\n      this.currentFieldsPage = currentPage;\n    } else {\n      this.currentValuesPage = currentPage;\n    }\n\n    this.showPageResults(fieldsOrValues);\n    this.addpageBtnEvt();\n  }\n\n  /**\n   * Shows current page results on fields/values area.\n   * @public\n   * @function\n   * @api\n   * @param {HTML Element} fieldsOrValues - element where items will be shown\n   */\n  showPageResults(fieldsOrValues) {\n    if (fieldsOrValues === 'fields') {\n      const fields = this.fieldsPages[this.currentFieldsPage];\n      const options = { jsonp: true, vars: { fields } };\n      this.fieldsTemplate = M.template.compileSync(fieldsTemplate, options);\n      this.fieldsTemplate.querySelector('#pageNumBtn').innerHTML = `${this.currentFieldsPage + 1} de ${this.fieldsPages.length}`;\n      this.showFields();\n    } else {\n      const values = this.valuesPages[this.currentValuesPage];\n      const options = { jsonp: true, vars: { values } };\n      this.valuesTemplate = M.template.compileSync(valuesTemplate, options);\n      this.valuesTemplate.querySelector('#pageNumBtn').innerHTML = `${this.currentValuesPage + 1} de ${this.valuesPages.length}`;\n      this.fieldsTemplate.querySelector('#pageNumBtn').innerHTML = `${this.currentFieldsPage + 1} de ${this.fieldsPages.length}`;\n      document.querySelector('#m-filteredsearch-values').innerHTML = '<p class=\"m-filteredsearch-headers\">Valores</p>';\n      document.querySelector('#m-filteredsearch-values').appendChild(this.valuesTemplate);\n      document.querySelector('#m-filteredsearch-values').querySelectorAll('td').forEach((cell) => {\n        // turns string into HTML Element if cell content is an HTML Element\n        // const htmlContent = document.createElement('div');\n        // htmlContent.innerHTML = cell.innerText;\n        // cell.removeChild(cell.firstChild);\n        // cell.appendChild(htmlContent);\n\n        cell.addEventListener('click', (e) => {\n          const txtarea = document.querySelector('.filtered-search-panel').querySelector('textarea');\n          txtarea.value += e.target.innerHTML;\n          this.sqlQuery += e.target.innerHTML;\n          Array.prototype.forEach.call(\n            e.target.parentNode.parentNode.parentNode.children[0].children,\n            (row) => {\n              Array.prototype.forEach.call(row.children, (rowCell) => {\n                rowCell.classList.remove('focus');\n              });\n            },\n          );\n          e.target.classList.add('focus');\n        });\n      });\n    }\n  }\n\n  /**\n   * Shows possible values for selected field.\n   * @public\n   * @function\n   * @param {Array} values - existing values for selected field\n   * @api\n   */\n  selectField(fieldValues) {\n    // reduces field values to unique possible values\n    const values = fieldValues.filter((value, index, self) => {\n      return self.indexOf(value) === index;\n    });\n\n    this.valuesPages = this.divideList(values);\n    const firstValues = this.valuesPages[0];\n    const options = { jsonp: true, vars: { values: firstValues } };\n\n    this.currentFieldsPage = 0;\n    this.currentValuesPage = 0;\n\n    this.valuesTemplate = M.template.compileSync(valuesTemplate, options);\n    this.valuesTemplate.querySelector('#pageNumBtn').innerHTML = `${this.currentValuesPage + 1} de ${this.valuesPages.length}`;\n\n    // turns string into HTML Element (in case cell content is an HTML Element)\n    // this.valuesTemplate.querySelectorAll('td').forEach((cell) => {\n    //   if (cell.innerText.charAt(0) === '<') {\n    //     const htmlContent = document.createElement('div');\n    //     htmlContent.innerHTML = cell.innerText;\n    //     cell.removeChild(cell.firstChild);\n    //     cell.appendChild(htmlContent);\n    //   }\n    // });\n\n    this.valuesTemplate.querySelectorAll('#m-filteredsearch-valuestable>tbody>tr>td').forEach((tableCell) => {\n      tableCell.addEventListener('click', e => this.selectValue(e));\n    });\n    document.querySelector('#m-filteredsearch-values').innerHTML = '<p class=\\'m-filteredsearch-headers\\'>Valores</p>';\n    document.querySelector('#m-filteredsearch-values').appendChild(this.valuesTemplate);\n    this.addpageBtnEvt();\n  }\n\n  /**\n   * Adds clicked option info to textarea and query.\n   * @public\n   * @function\n   * @param {Event} e - triggering event\n   * @api\n   */\n  selectValue(e) {\n    const txtarea = document.querySelector('.filtered-search-panel').querySelector('textarea');\n    txtarea.value += e.currentTarget.innerHTML;\n    this.sqlQuery += e.currentTarget.innerHTML;\n    Array.prototype.forEach.call(\n      e.currentTarget.parentNode.parentNode.children,\n      (row) => {\n        row.children[0].classList.remove('focus');\n      },\n    );\n    e.currentTarget.classList.add('focus');\n  }\n\n  /**\n   * Checks if map has given layer and returns that layer.\n   *\n   * @private\n   * @param {array<string>| string| M.Layer} layerSearch -\n        Array of layer names, layer name or layer instance\n   * @function\n   */\n  hasLayer_(layerSearch) {\n    const layersFind = [];\n    if (M.utils.isNullOrEmpty(layerSearch) || (!M.utils.isArray(layerSearch) &&\n        !M.utils.isString(layerSearch) && !(layerSearch instanceof M.Layer))) {\n      M.dialog.error('El parametro para el método hasLayer no es correcto.', 'Error');\n      return layersFind;\n    }\n\n    if (M.utils.isString(layerSearch)) {\n      this.map.getLayers().forEach((lay) => {\n        if (lay.name === layerSearch) {\n          layersFind.push(lay);\n        }\n      });\n    }\n\n    if (layerSearch instanceof M.Layer) {\n      this.map.getLayers().forEach((lay) => {\n        if (lay.equals(layerSearch)) {\n          layersFind.push(lay);\n        }\n      });\n    }\n    if (M.utils.isArray(layerSearch)) {\n      this.map.getLayers().forEach((lay) => {\n        if (layerSearch.indexOf(lay.name) >= 0) {\n          layersFind.push(lay);\n        }\n      });\n    }\n    return layersFind;\n  }\n\n  /**\n   * This function compares controls\n   *\n   * @public\n   * @function\n   * @param {M.Control} control to compare\n   * @api stable\n   */\n  equals(control) {\n    return control instanceof FilteredSearchControl;\n  }\n}\n","/**\n * @module M/plugin/FilteredSearch\n */\nimport 'assets/css/filteredsearch';\nimport FilteredSearchControl from './filteredsearchcontrol';\n\nexport default class FilteredSearch extends M.Plugin {\n  /**\n   * @classdesc\n   * Main facade plugin object. This class creates a plugin\n   * object which has an implementation Object\n   *\n   * @constructor\n   * @extends {M.Plugin}\n   * @param {Object} impl implementation object\n   * @api stable\n   */\n  constructor(options) {\n    super();\n    /**\n     * Facade of the map\n     * @private\n     * @type {M.Map}\n     */\n    this.map_ = null;\n\n    /**\n     * Array of controls\n     * @private\n     * @type {Array<M.Control>}\n     */\n    this.controls_ = [];\n\n    /**\n     * Position of the plugin on browser window\n     * @private\n     * @type {String}\n     * Possible values: 'TL', 'TR', 'BR', 'BL'\n     */\n    this.position = options.position || 'TR';\n  }\n\n  /**\n   * This function adds this plugin into the map\n   *\n   * @public\n   * @function\n   * @param {M.Map} map the map to add the plugin\n   * @api stable\n   */\n  addTo(map) {\n    this.controls_.push(new FilteredSearchControl());\n    this.map_ = map;\n    // panel para agregar control - no obligatorio\n    this.panel_ = new M.ui.Panel('panelFilteredSearch', {\n      className: 'filtered-search-panel',\n      collapsible: true,\n      position: M.ui.position[this.position_],\n      collapsedButtonClass: 'g-cartografia-flecha-izquierda',\n    });\n    this.panel_.addControls(this.controls_);\n    map.addPanels(this.panel_);\n  }\n}\n","import M$plugin$FilteredSearch from './/facade/js/filteredsearch';\nimport M$control$FilteredSearchControl from './/facade/js/filteredsearchcontrol';\nimport M$impl$control$FilteredSearchControl from './/impl/ol/js/filteredsearchcontrol';\n\nif (!window.M.plugin) window.M.plugin = {};\nif (!window.M.control) window.M.control = {};\nif (!window.M.impl) window.M.impl = {};\nif (!window.M.impl.control) window.M.impl.control = {};\nwindow.M.plugin.FilteredSearch = M$plugin$FilteredSearch;\nwindow.M.control.FilteredSearchControl = M$control$FilteredSearchControl;\nwindow.M.impl.control.FilteredSearchControl = M$impl$control$FilteredSearchControl;\n"],"sourceRoot":""}